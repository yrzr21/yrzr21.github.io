<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="lab6 thread Multithreading" />
    <meta name="hexo-theme-A4" content="v1.9.2" />
    <link rel="alternate icon" type="image/webp" href="/img/logo.jpg">
    <title>Toki</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.2.0"></head>
    
    
        <style>
            .index-main{
                max-width:  880px;
            }
        </style>

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/logo.jpg" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Toki</a> 
            <span class="description">Why so serious?</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/contact/">è”ç³»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        
            
                <div class="post-main-title">
                    lab6 thread Multithreading
                </div>
            
        
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#thread"><span class="post-toc-text">thread</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Uthread-switching-between-threads"><span class="post-toc-text">Uthread: switching between threads</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="post-toc-text">æ€è·¯</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Using-threads"><span class="post-toc-text">Using threads</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%80%9D%E8%B7%AF-1"><span class="post-toc-text">æ€è·¯</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Barrier"><span class="post-toc-text">Barrier</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90"><span class="post-toc-text">åˆ†æ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%80%9D%E8%B7%AF-2"><span class="post-toc-text">æ€è·¯</span></a></li></ol></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css"><div class=".article-gallery"><h2 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h2><h3 id="Uthread-switching-between-threads"><a href="#Uthread-switching-between-threads" class="headerlink" title="Uthread: switching between threads"></a>Uthread: switching between threads</h3><blockquote>
<p>In this exercise you will design the context switch mechanism for a user-level threading system, and then implement it. To get you started, your xv6 has two files user&#x2F;uthread.c and user&#x2F;uthread_switch.S, and a rule in the Makefile to build a uthread program. uthread.c contains most of a user-level threading package, and code for three simple test threads. The threading package is missing some of the code to create a thread and to switch between threads.</p>
</blockquote>
<p>æ‚¨çš„å·¥ä½œæ˜¯åˆ¶å®šä¸€ä¸ªè®¡åˆ’æ¥åˆ›å»ºçº¿ç¨‹å¹¶ä¿å­˜&#x2F;æ¢å¤å¯„å­˜å™¨ä»¥åœ¨çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œå¹¶å®æ–½è¯¥è®¡åˆ’ã€‚å½“ä½ å®Œæˆåï¼ŒÂ make gradeÂ åº”è¯¥è¯´ä½ çš„è§£å†³æ–¹æ¡ˆé€šè¿‡äº†Â uthreadÂ æµ‹è¯•ã€‚</p>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ra æ˜¯ caller-savedï¼Œæ— éœ€ç‰¹æ®Šå¤„ç†ï¼Œåœ¨è°ƒç”¨å‰ä¼šè‡ªåŠ¨æ›´æ–° raï¼š<code>auipc Â  ra,0x0</code></p>
<p>ä»…éœ€è¦ä¿å­˜&#x2F;æ¢å¤è¢«è°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨ï¼Œä»¥åŠraâ€”â€”ç”¨äºè°ƒåº¦</p>
<p>å¢åŠ ä¸€ä¸ªç»“æ„ä½“ ucontextï¼Œä¿å­˜callee-savedå¯„å­˜å™¨ä¸ra</p>
<p>åˆ›å»ºç”¨æˆ·çº¿ç¨‹æ—¶éœ€è¦åˆå§‹åŒ– stateã€ä¸Šä¸‹æ–‡ä¸­çš„ raã€sp ç­‰ç­‰</p>
<p>sp éœ€è¦è¿™æ ·åˆå§‹åŒ–ï¼Œå¾—åŠ ä¸ªSIZEï¼š</p>
<a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823220941.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823220941.png" class title="Pasted image 20240823220941.png"></a>

<h3 id="Using-threads"><a href="#Using-threads" class="headerlink" title="Using threads"></a>Using threads</h3><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ä½¿ç”¨<code>ç»†ç²’åº¦çš„é”</code>å¯ä»¥é¿å…æŸäº›é”äº‰ç”¨ï¼šä»¥ bucket ä¸ºå•ä½</p>
<a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823224834.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823224834.png" class title="Pasted image 20240823224834.png"></a>

<p>ä½¿ç”¨äº†ï¼š</p>
<a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823231008.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240823231008.png" class title="Pasted image 20240823231008.png"></a>


<h3 id="Barrier"><a href="#Barrier" class="headerlink" title="Barrier"></a>Barrier</h3><a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824014948.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824014948.png" class title="Pasted image 20240824014948.png"></a>

<a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824015005.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824015005.png" class title="Pasted image 20240824015005.png"></a>


<h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>è¦æ±‚ï¼šå¿…é¡»ç­‰å¾…æŒ‡å®šæ•°é‡çš„çº¿ç¨‹è°ƒç”¨ barrierï¼Œæ‰å¯å”¤é†’æ‰€æœ‰çº¿ç¨‹ç»§ç»­å·¥ä½œï¼›åŒæ—¶ï¼Œä¼šè¿›è¡Œå¤šè½®çš„ barrier è°ƒç”¨ï¼Œæ¯ä¸€è½®å®Œæˆæ—¶éœ€è¦æ›´æ–°è½®æ¬¡</p>
<ul>
<li>ä¸Šä¸€è½®çš„ nthread è®¡æ•°ä¼šå½±å“åˆ°ä¸‹ä¸€è½®ï¼Œéœ€è¦æ‰¾ä¸ªåœ°æ–¹æ¸…ç©º</li>
<li>å­˜åœ¨å¤šä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€ä¸ªå‡½æ•° barrierï¼Œä½† nthread è®¡æ•°å’Œ è½®æ¬¡ å¿…é¡»åªæ›´æ–°ä¸€æ¬¡</li>
<li>è·‘å¾—å¿«çš„çº¿ç¨‹å¯èƒ½å·²ç»è¿›å…¥äº†ä¸‹ä¸€è½®ï¼Œå†æ¬¡è°ƒç”¨ barrierã€ä¿®æ”¹äº† nthread åè¿›å…¥ç¡çœ ï¼›è·‘çš„æ…¢çš„è¿›ç¨‹å¦‚æœæ­¤æ—¶è¿˜åœç•™åœ¨ä¸Šæ¬¡ barrier è°ƒç”¨ï¼Œä¿®æ”¹ nthread æˆ–è€…å…¶ä»–ç›¸å…³çš„å˜é‡ï¼Œä»¥æ›´æ–°æ•°æ®è¿›å…¥ä¸‹ä¸€è½®ï¼Œåˆ™ä¼šä¹±å¥—</li>
<li>é‡å¤çš„ broadcast ä¼šå¯¼è‡´è¯¸å¤šä¼ªå”¤é†’ï¼Œè¿™ä¸ªé—®é¢˜ä¸å¤§å¯ä»¥ç”¨whileè§£å†³ï¼Œä½†æ˜¯å…¶ä»–é—®é¢˜å°±ä¸å¥½è§£å†³äº†</li>
</ul>
<h4 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ul>
<li>æ‰€ä»¥æœ€å¥½æ˜¯åœ¨æœ€åä¸€ä¸ªçº¿ç¨‹æŠµè¾¾æ—¶å°±æ›´æ–°æ•°æ®ï¼Œ<code>æˆ‘ä»¬åœ¨æ­¤æ—¶è¿›å…¥ä¸‹ä¸€è½®</code></li>
<li>ç„¶åç›´æ¥å”¤é†’å…¶ä»–çº¿ç¨‹ï¼Œä¸è¿›å…¥ç¡çœ </li>
<li>éæœ€åä¸€ä¸ªçº¿ç¨‹ç¡çœ è¢«å”¤é†’åå°±ä¸ä¿®æ”¹ä»»ä½•æ•°æ®ï¼Œç›´æ¥é‡Šæ”¾é”é€€å‡º barrier</li>
<li>ç”±äºä¸ä¿®æ”¹ä»»ä½•æ•°æ®ï¼Œä¸åšä»»ä½•æ“ä½œï¼Œè·‘å¾—å¿«æ…¢å¯¹è½®æ¬¡å®Œå…¨æ²¡æœ‰ä»»ä½•å½±å“</li>
</ul>
<p>æœ€åçš„ä»£ç åƒè¿™æ ·ï¼š</p>
<a href="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824014718.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/24/6.s081%20lab6%20Thread/Pasted%20image%2020240824014718.png" class title="Pasted image 20240824014718.png"></a>






</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-08-24</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Toki</span>
            
            
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/6-s081/'>
                            6.s081
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 2024 

            
                

            
                
                    / <a href="/contact/"> è”ç³» </a>
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
            
    </body>
</html>
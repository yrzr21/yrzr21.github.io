<!DOCTYPE html>
<html lang="zh-CN">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="lab3 Page Table" />
    <meta name="hexo-theme-A4" content="v1.9.2" />
    <link rel="alternate icon" type="image/webp" href="/img/logo.jpg">
    <title>Toki</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery.min.css">


<meta name="generator" content="Hexo 7.2.0"></head>
    
    
        <style>
            .index-main{
                max-width:  880px;
            }
        </style>

    
    



    

    
    

    
    
    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            <div class="left-toc-container">
                <nav id="toc" class="bs-docs-sidebar"></nav>
            </div>
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <img style="
        width: 56px;
        height: auto;" alt="^-^" cache-control="max-age=86400" class="header-img" src="/img/logo.jpg" width="10%"></img>
        <div class="header-content">
            <a class="logo" href="/">Toki</a> 
            <span class="description">Why so serious?</span> 
        </div>
        
    </div>
    
   
    <ul class="nav">
        
            
                <li><a href="/">é¦–é¡µ</a></li>
            
        
            
                <li><a href="/list/">æ–‡ç« </a></li>
            
        
            
                <li><a href="/categories/">åˆ†ç±»</a></li>
            
        
            
                <li><a href="/contact/">è”ç³»</a></li>
            
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">

    
        
            
                <div class="post-main-title">
                    lab3 Page Table
                </div>
            
        
      
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Page-Table"><span class="post-toc-text">Page Table</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Speed-up-system-calls"><span class="post-toc-text">Speed up system calls</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B7%B2%E7%9F%A5%E7%9A%84%E6%83%85%E6%8A%A5"><span class="post-toc-text">ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%86%E6%9E%90"><span class="post-toc-text">åˆ†æ</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#exec"><span class="post-toc-text">exec</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Print-a-page-table"><span class="post-toc-text">Print a page table</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%80%E4%BA%9B%E5%B7%B2%E7%9F%A5%E7%9A%84%E6%83%85%E6%8A%A5-1"><span class="post-toc-text">ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%8F%E8%8E%B7%E5%8F%96-PTE-PA"><span class="post-toc-text">ä½¿ç”¨å®è·å– PTE &#x2F; PA</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Detect-which-pages-have-been-accessed"><span class="post-toc-text">Detect which pages have been accessed</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="post-toc-text">æ€è·¯</span></a></li></ol></li></ol></li></ol>
            
        
        <link rel="stylesheet" type="text/css" href="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/css/lightgallery.min.css"><div class=".article-gallery"><h2 id="Page-Table"><a href="#Page-Table" class="headerlink" title="Page Table"></a>Page Table</h2><h3 id="Speed-up-system-calls"><a href="#Speed-up-system-calls" class="headerlink" title="Speed up system calls"></a>Speed up system calls</h3><h4 id="ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥"><a href="#ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥" class="headerlink" title="ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥"></a>ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥</h4><a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240810080807.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240810080807.png" class title="Pasted image 20240810080807.png"></a>

<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809203658.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809203658.png" class title="Pasted image 20240809203658.png"></a>

<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811170923.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811170923.png" class title="Pasted image 20240811170923.png"></a>

<ol>
<li>RAM èŒƒå›´ä» 0x8000 0000 åˆ° 0x8800 0000</li>
<li>å†…æ ¸åœ°å€ç©ºé—´0x8800 0000ä»¥ä¸‹çš„åœ°å€å‡ä½¿ç”¨æ’ç­‰æ˜ å°„ï¼Œè¿™äº› va éƒ½å¯ä»¥è§†ä½œ pa<ul>
<li>å¯ä»¥è®¤ä¸º kalloc è¿”å›çš„å°±æ˜¯å®é™…ç‰©ç†åœ°å€</li>
</ul>
</li>
</ol>
<p>shell æ‰§è¡Œæ–°ç¨‹åºçš„é€»è¾‘ï¼šfork -&gt; exec</p>
<h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>ç³»ç»Ÿè°ƒç”¨éœ€è¦åˆ‡æ¢åœ°å€ç©ºé—´ï¼Œè¿™ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œä¸€äº›åªè¯»çš„æ•°æ®å¯ä»¥æ”¾åˆ°å…±äº«ç©ºé—´ç„¶åè®©ç”¨æˆ·ç›´æ¥è¯»å–ï¼Œä»è€Œé¿å…ç³»ç»Ÿè°ƒç”¨</p>
<p>åœ¨ç”¨æˆ·åœ°å€ç©ºé—´åŠ ä¸€ä¸ª USYSCALL æ®µï¼š</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811105337.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811105337.png" class title="Pasted image 20240811105337.png"></a>


<p>æˆ‘çš„æ€è·¯ï¼šåˆ›å»ºç”¨æˆ·è¿›ç¨‹çš„æ–¹å¼ä¸ºï¼š<em>exec</em>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨execä¸­æ˜ å°„ USYSCALL é¡µã€‚</p>
<p>è¿›ä¸€æ­¥æŸ¥çœ‹ exec çš„ä»£ç åå‘ç°å¹¶ä¸æ˜¯æ”¹ exec çš„ä»£ç ï¼Œåº”è¯¥åœ¨ proc ç»“æ„ä½“ä¸­æ·»åŠ  usyscall ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæ”¹ proc.c çš„ <em>proc_pagetable</em> ä»¥æ·»åŠ æ˜ å°„</p>
<ul>
<li>ä»¥åŠ forkã€userinitã€proc_freepagetableã€freeprocã€allocproc</li>
<li><em>å‚è€ƒ trapframe çš„å¤„ç†</em></li>
<li>proc_pagetable åˆ›å»ºä¸€ä¸ªç©ºé¡µè¡¨ï¼Œå¹¶æ˜ å°„ç”¨æˆ·åœ°å€ç©ºé—´é¡¶éƒ¨çš„ TRAMPOLINE å’Œ TRAPFRAMEï¼Œæˆ‘ä»¬å†ç»™ä»–åŠ ä¸€ä¸ªæ˜ å°„</li>
</ul>
<p><em>åˆ«çœ‹ proc ç»“æ„ä½“ä¸­çš„ trapframe æŒ‡é’ˆç”¨ kalloc åˆ†é…ï¼Œè¿™ä¹Ÿæ˜¯è™šæ‹Ÿåœ°å€ï¼Œä½†å¯ä»¥è®¤ä¸ºæ˜¯ç‰©ç†åœ°å€</em></p>
<p>å†…æ ¸åœ°å€ç©ºé—´å’Œç”¨æˆ·åœ°å€ç©ºé—´çš„é¡µè¡¨ä¸åŒ</p>
<p><code>forkæ—¶ä¸èƒ½å¤åˆ¶åŸæ¥çš„ usys_data</code>ï¼Œè¿™ä¸ªç‚¹å¡æˆ‘äº†åŠå¤©</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><ol>
<li><p>ä»æŒ‡å®šæ–‡ä»¶åœ°å€æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–ELFå¤´ï¼Œæ ¹æ® magic æ£€æŸ¥ELFï¼Œåˆå§‹åŒ–æ–°é¡µè¡¨</p>
</li>
<li><p>æ ¹æ®ç¨‹åºæ®µå¤´ proghdr åŠ è½½ text å’Œ data åˆ°å†…å­˜ä¸­</p>
</li>
<li><p>åˆ†é…ä¸¤ä¸ªé¡µæ”¾ stack å’Œ guard å¹¶ æ¸…ç©º guard ä¸º0ã€‚</p>
</li>
<li><p>å…¥æ ˆå­—ç¬¦ä¸²å‚æ•°ï¼Œå°†å…¶åœ°å€å­˜å‚¨åœ¨ ustack ä¸­ã€‚æœ«å°¾ä¸º0ã€‚ç„¶åå…¥æ ˆ ustackã€‚argc æ˜¯è¿”å›å€¼æ”¾åˆ° a0ï¼Œargv æ”¾åˆ° a1</p>
<ul>
<li>å…¥æ ˆæ—¶è¦å¯¹é½ï¼Œé€šè¿‡ï¼šsp -&#x3D; sp%16</li>
</ul>
</li>
<li><p>è®¾ç½®æ›´æ–°è¿›ç¨‹çš„ä¸€äº›å±æ€§ï¼špagetableã€sizeã€epcã€spï¼Œç„¶åé‡Šæ”¾åŸè¿›ç¨‹çš„ç‰©ç†å†…å­˜ï¼Œè¿”å› argc</p>
</li>
</ol>
<p>å¦å¤–ï¼Œxv6æ˜¯å°ç«¯åºï¼Œå¯ä»¥ä»è¿™æ®µå…¥æ ˆå­—ç¬¦ä¸²çš„ä»£ç ä¸­çœ‹å‡ºï¼š</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811113543.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811113543.png" class title="Pasted image 20240811113543.png"></a>


<h3 id="Print-a-page-table"><a href="#Print-a-page-table" class="headerlink" title="Print a page table"></a>Print a page table</h3><h4 id="ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥-1"><a href="#ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥-1" class="headerlink" title="ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥"></a>ä¸€äº›å·²çŸ¥çš„æƒ…æŠ¥</h4><a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809193645.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809193645.png" class title="Pasted image 20240809193645.png"></a>

<p>â€”â€”åˆ†çº§è®¿é—®å³å¯</p>
<h4 id="ä½¿ç”¨å®è·å–-PTE-PA"><a href="#ä½¿ç”¨å®è·å–-PTE-PA" class="headerlink" title="ä½¿ç”¨å®è·å– PTE &#x2F; PA"></a>ä½¿ç”¨å®è·å– PTE &#x2F; PA</h4><blockquote>
<p>riscv.h</p>
</blockquote>
<p>éœ€è¦æ³¨æ„ä¸€ä¸‹ç±»å‹è½¬æ¢</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192150.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192150.png" class title="Pasted image 20240811192150.png"></a>

<p>æ ¹æ® va è·å– Lk é¡µè¡¨çš„é¡µå·ï¼š</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192208.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192208.png" class title="Pasted image 20240811192208.png"></a>

<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192327.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192327.png" class title="Pasted image 20240811192327.png"></a>

<p>å¸¸ç”¨æƒé™ä½ï¼š</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192631.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240811192631.png" class title="Pasted image 20240811192631.png"></a>

<h3 id="Detect-which-pages-have-been-accessed"><a href="#Detect-which-pages-have-been-accessed" class="headerlink" title="Detect which pages have been accessed"></a>Detect which pages have been accessed</h3><blockquote>
<p>PTE_A ç”±ç¡¬ä»¶è¯»å†™è¯¥PTEæŒ‡å‘çš„æ•°æ®æ—¶è®¾ç½®ï¼Œç”±è½¯ä»¶æ¸…é™¤</p>
</blockquote>
<p>è¿™ä¸ªå®éªŒæ„Ÿè§‰æ²¡å•¥æ„æ€ï¼Œéš¾åº¦æ˜¯ hardï¼Œä½†å…¶å®åšèµ·æ¥åŠä¸ªå°æ—¶éƒ½ä¸åˆ°å°±å¯ä»¥åšå®Œ</p>
<a href="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809193645.png" class="gallery-item" style="box-shadow: none;"> <img src="/2024/08/11/6.s081%20lab3%20Page%20Table/Pasted%20image%2020240809193645.png" class title="Pasted image 20240809193645.png"></a>

<blockquote>
<p>Your job is to implementÂ pgaccess(), a system call that reports which pages have been accessed. The system call takes three arguments. First, it takes the starting virtual address of the first user page to check. Second, it takes the number of pages to check. Finally, it takes a user address to a buffer to store the results into a bitmask (a datastructure that uses one bit per page and where the first page corresponds to the least significant bit). You will receive full credit for this part of the lab if theÂ pgaccessÂ test case passes when runningÂ pgtbltest.</p>
</blockquote>
<h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æä¸€ä¸ª PTE_A å®ï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨ä¸­ç”¨argaddrç­‰å‡½æ•°è·å–å¯„å­˜å™¨å‚æ•°ï¼Œæ ¹æ®æä¾›çš„é¡µæŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯vmè·ç”¨ walk æ¨¡æ‹Ÿ MMU è·å– PTEï¼Œæ£€æŸ¥PTE_Aï¼Œè‹¥è®¾ç½®åˆ™è®°å½•å¹¶æ¸…ç©ºPTE_Aâ€¦å¾ªç¯ç»“æŸåå°†ç»“æœå¤åˆ¶åˆ°ç”¨æˆ·åœ°å€ç©ºé—´å³å¯</p>
</div><script src="https://jsd.cdn.zzko.cn/npm/hexo-theme-a4@latest/source/js/lightgallery.min.js"></script><script>if("undefined"!=typeof lightGallery) {
        var options1 = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1);
        }</script>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-08-11</span>
            
                <span>è¯¥ç¯‡æ–‡ç« è¢« Toki</span>
            
            
             
                <span>å½’ä¸ºåˆ†ç±»:
                    
                    
                        <a href='/categories/6-s081/'>
                            6.s081
                        </a>
                    
                </span>
            
        
        </i>
    </div>
    <br>
    
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 2024 

            
                

            
                
                    / <a href="/contact/"> è”ç³» </a>
                

            
        </span>
    
</div>
<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery.min.js"></script>



                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>